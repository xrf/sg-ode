{macros}
LIBS=-lm
harness=$(HARNESS) timeout 15

all: check

clean:
	rm -fr bin target *.o *.o_mpi *.ok

check: bin/ode_test.ok bin/vector_test.ok

doc:
	doxygen

lint: {lint_targets}

.PHONY: all clean check doc lint Makefile

{bins}

bin/ode_test.ok: bin/ode_test ode_demo.txt
	@mkdir -p $(@D)
	$(harness) bin/ode_test >ode_test.out
	@git --no-pager diff --exit-code --no-index ode_test.out $(src)ode_demo.txt
	@touch $@

bin/vector_test.ok: bin/vector_test
	@mkdir -p $(@D)
	$(harness) mpiexec -np 4 bin/vector_test
	@touch $@

vector_macros.h: vector_macros.py
	$(src)./vector_macros.py

.SUFFIXES: .c .o .o_mpi

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $<

.c.o_mpi:
	$(MPICC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $<

Makefile:
	@[ ! -x ./config.status ] || ./config.status

{lints}
{deps}
